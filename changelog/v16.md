# v16 — Narrative environment + DP-7 thought terminal

**Category:** feature

## Changes

### Depth-dependent wall/floor palette
- 5 hand-tuned color palettes shifting from cool blue (floor 1) → grey-blue (2) → amber (3) → deep red (4) → crimson (5)
- Walls, floor tiles, panel lines, and accents all shift with depth — the facility visually corrupts as you descend
- Floor 3+: cable traces appear on floor tiles (subtle horizontal lines)
- Floor 3+: damage marks appear on wall faces (small dots suggesting decay/combat history)

### DP-7 thought bubble
- Animated speech bubble floating above the player character
- Follows player position, flips below when near top of screen
- Connector line from bubble to player for visual anchoring
- Typewriter effect with blinking cursor while text appears
- Dark terminal-style panel with cyan border and scan lines
- `[SPC]` dismiss hint after typing completes — Space closes the bubble
- Fades out naturally after 8 seconds if not dismissed
- Shows only the latest thought (one bubble at a time)

### Context-sensitive thoughts
- **Floor entry**: unique thoughts per depth level ("Memory: empty. Move forward." → "The core. My origin.")
- **Combat**: terse kill reactions ("Efficient.", "One less.", "They fall.")
- **Damage/low health**: system warnings ("Hull breach. Continue.", "Systems critical.")
- **Data pickup**: memory fragments ("Another piece of me.", "Who was I?")
- **Module pickup**: reclamation ("Hardware. Mine.", "Taking it back.")
- **Terminal hack**: data access ("The system remembers me.", "What are you hiding?")
- **Path-specific**: hunter/ghost/archivist flavor ("Built for this.", "I am a glitch.", "Every byte rebuilds me.")
- **Ambient** (every 20 turns): existential musings ("The cameras never blink.", "Escaping or being led?")
- 5-turn cooldown between thoughts prevents spam

### Thought trigger system
- `checkThoughts()` runs at end of each turn, compares current state to previous snapshot
- Detects kills, damage, pickups, floor changes, path activation, terminal hacks
- All triggers centralized — no scattered event hooks

## Reasoning

Player wanted walls/floor to contribute to narrative ("daj mi cos z tym do narracji") and a visible thought log showing what the protagonist thinks ("co mysli glowny bohater w animowanym terminalu"). The depth palette creates a visual narrative arc — clean facility → corrupted core. The thought terminal makes DP-7 feel alive: a damaged AI processing its world in terse, fragmented observations. The typewriter effect sells the "terminal output" aesthetic. Thoughts are short (under 30 chars) so they fit the terminal width and feel like system log entries, not prose.

## Files modified

- `data.js` — 12 thought categories with ~40 unique lines, organized by trigger type
- `game.js` — addThought, triggerThought, checkThoughts functions; thought state init; triggers in endTurn and changeFloor
- `render.js` — PALETTES array (5 depth-dependent color sets), palette lookup in map layer, floor cable traces, wall damage marks, terminal overlay layer (z=26) with typewriter + cursor + scan lines
- `main.js` — thought typewriter timer and lifecycle in update loop
